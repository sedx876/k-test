{"ast":null,"code":"var _jsxFileName = \"/Users/sharonwatkins/Desktop/Code/kline/client/src/pages/Checkout.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport { getUserCart, emptyUserCart, saveUserAddress, applyCoupon, createCashOrderForUser } from \"../functions/user\";\nimport ReactQuill from \"react-quill\";\nimport \"react-quill/dist/quill.snow.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Checkout = _ref => {\n  _s();\n\n  let {\n    history\n  } = _ref;\n  const [products, setProducts] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [address, setAddress] = useState(\"\");\n  const [addressSaved, setAddressSaved] = useState(false);\n  const [coupon, setCoupon] = useState(\"\"); // discount price\n\n  const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\n  const [discountError, setDiscountError] = useState(\"\");\n  const dispatch = useDispatch();\n  const {\n    user,\n    COD\n  } = useSelector(state => ({ ...state\n  }));\n  const couponTrueOrFalse = useSelector(state => state.coupon);\n  useEffect(() => {\n    getUserCart(user.token).then(res => {\n      console.log(\"user cart res\", JSON.stringify(res.data, null, 4));\n      setProducts(res.data.products);\n      setTotal(res.data.cartTotal);\n    });\n  }, []);\n\n  const emptyCart = () => {\n    // remove from local storage\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(\"cart\");\n    } // remove from redux\n\n\n    dispatch({\n      type: \"ADD_TO_CART\",\n      payload: []\n    }); // remove from backend\n\n    emptyUserCart(user.token).then(res => {\n      setProducts([]);\n      setTotal(0);\n      setTotalAfterDiscount(0);\n      setCoupon(\"\");\n      toast.success(\"Cart is emapty. Contniue shopping.\");\n    });\n  };\n\n  const saveAddressToDb = () => {\n    // console.log(address);\n    saveUserAddress(user.token, address).then(res => {\n      if (res.data.ok) {\n        setAddressSaved(true);\n        toast.success(\"Address saved\");\n      }\n    });\n  };\n\n  const applyDiscountCoupon = () => {\n    console.log(\"send coupon to backend\", coupon);\n    applyCoupon(user.token, coupon).then(res => {\n      console.log(\"RES ON COUPON APPLIED\", res.data);\n\n      if (res.data) {\n        setTotalAfterDiscount(res.data); // update redux coupon applied true/false\n\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: true\n        });\n      } // error\n\n\n      if (res.data.err) {\n        setDiscountError(res.data.err); // update redux coupon applied true/false\n\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false\n        });\n      }\n    });\n  };\n\n  const showAddress = () => /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(ReactQuill, {\n      theme: \"snow\",\n      value: address,\n      onChange: setAddress\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn btn-primary mt-2\",\n      onClick: saveAddressToDb,\n      children: \"Save\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n\n  const showProductSummary = () => products.map((p, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [p.product.title, \" (\", p.color, \") x \", p.count, \" =\", \" \", p.product.price * p.count]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 9\n    }, this)\n  }, i, false, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 7\n  }, this));\n\n  const showApplyCoupon = () => /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n      onChange: e => {\n        setCoupon(e.target.value);\n        setDiscountError(\"\");\n      },\n      value: coupon,\n      type: \"text\",\n      className: \"form-control\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: applyDiscountCoupon,\n      className: \"btn btn-primary mt-2\",\n      children: \"Apply\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n\n  const createCashOrder = () => {\n    createCashOrderForUser(user.token, COD, couponTrueOrFalse).then(res => {\n      console.log(\"USER CASH ORDER CREATED RES \", res); // empty cart form redux, local Storage, reset coupon, reset COD, redirect\n\n      if (res.data.ok) {\n        // empty local storage\n        if (typeof window !== \"undefined\") localStorage.removeItem(\"cart\"); // empty redux cart\n\n        dispatch({\n          type: \"ADD_TO_CART\",\n          payload: []\n        }); // empty redux coupon\n\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false\n        }); // empty redux COD\n\n        dispatch({\n          type: \"COD\",\n          payload: false\n        }); // mepty cart from backend\n\n        emptyUserCart(user.token); // redirect\n\n        setTimeout(() => {\n          history.push(\"/user/history\");\n        }, 1000);\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"row\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-md-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Delivery Address\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n        className: \"text-danger\",\n        children: \"*Please Include Full Name and Address*\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h6\", {\n        className: \"text-danger\",\n        children: \"*Save Address Before Submitting Order*\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }, this), showAddress(), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Got Coupon?\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }, this), showApplyCoupon(), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this), discountError && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"bg-danger p-2\",\n        children: discountError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 27\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-md-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Order Summary\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"Products \", products.length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 9\n      }, this), showProductSummary(), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"Cart Total: \", total]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }, this), totalAfterDiscount > 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"bg-success p-2\",\n        children: [\"Discount Applied: Total Payable: $\", totalAfterDiscount]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-md-6\",\n          children: COD ? /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-primary\",\n            disabled: !addressSaved || !products.length,\n            onClick: createCashOrder,\n            children: \"Place Order\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-primary\",\n            disabled: !addressSaved || !products.length,\n            onClick: () => history.push(\"/payment\"),\n            children: \"Place Order\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-md-6\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            disabled: !products.length,\n            onClick: emptyCart,\n            className: \"btn btn-primary\",\n            children: \"Empty Cart\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 159,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Checkout, \"aR6hG+itq/TWtj0BZwuzbjc4RdI=\", false, function () {\n  return [useDispatch, useSelector, useSelector];\n});\n\n_c = Checkout;\nexport default Checkout;\n\nvar _c;\n\n$RefreshReg$(_c, \"Checkout\");","map":{"version":3,"sources":["/Users/sharonwatkins/Desktop/Code/kline/client/src/pages/Checkout.js"],"names":["React","useEffect","useState","useSelector","useDispatch","toast","getUserCart","emptyUserCart","saveUserAddress","applyCoupon","createCashOrderForUser","ReactQuill","Checkout","history","products","setProducts","total","setTotal","address","setAddress","addressSaved","setAddressSaved","coupon","setCoupon","totalAfterDiscount","setTotalAfterDiscount","discountError","setDiscountError","dispatch","user","COD","state","couponTrueOrFalse","token","then","res","console","log","JSON","stringify","data","cartTotal","emptyCart","window","localStorage","removeItem","type","payload","success","saveAddressToDb","ok","applyDiscountCoupon","err","showAddress","showProductSummary","map","p","i","product","title","color","count","price","showApplyCoupon","e","target","value","createCashOrder","setTimeout","push","length"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport {\n  getUserCart,\n  emptyUserCart,\n  saveUserAddress,\n  applyCoupon,\n  createCashOrderForUser,\n} from \"../functions/user\";\nimport ReactQuill from \"react-quill\";\nimport \"react-quill/dist/quill.snow.css\";\n\nconst Checkout = ({ history }) => {\n  const [products, setProducts] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [address, setAddress] = useState(\"\");\n  const [addressSaved, setAddressSaved] = useState(false);\n  const [coupon, setCoupon] = useState(\"\");\n  // discount price\n  const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\n  const [discountError, setDiscountError] = useState(\"\");\n\n  const dispatch = useDispatch();\n  const { user, COD } = useSelector((state) => ({ ...state }));\n  const couponTrueOrFalse = useSelector((state) => state.coupon);\n\n  useEffect(() => {\n    getUserCart(user.token).then((res) => {\n      console.log(\"user cart res\", JSON.stringify(res.data, null, 4));\n      setProducts(res.data.products);\n      setTotal(res.data.cartTotal);\n    });\n  }, []);\n\n  const emptyCart = () => {\n    // remove from local storage\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(\"cart\");\n    }\n    // remove from redux\n    dispatch({\n      type: \"ADD_TO_CART\",\n      payload: [],\n    });\n    // remove from backend\n    emptyUserCart(user.token).then((res) => {\n      setProducts([]);\n      setTotal(0);\n      setTotalAfterDiscount(0);\n      setCoupon(\"\");\n      toast.success(\"Cart is emapty. Contniue shopping.\");\n    });\n  };\n\n  const saveAddressToDb = () => {\n    // console.log(address);\n    saveUserAddress(user.token, address).then((res) => {\n      if (res.data.ok) {\n        setAddressSaved(true);\n        toast.success(\"Address saved\");\n      }\n    });\n  };\n\n  const applyDiscountCoupon = () => {\n    console.log(\"send coupon to backend\", coupon);\n    applyCoupon(user.token, coupon).then((res) => {\n      console.log(\"RES ON COUPON APPLIED\", res.data);\n      if (res.data) {\n        setTotalAfterDiscount(res.data);\n        // update redux coupon applied true/false\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: true,\n        });\n      }\n      // error\n      if (res.data.err) {\n        setDiscountError(res.data.err);\n        // update redux coupon applied true/false\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false,\n        });\n      }\n    });\n  };\n\n  const showAddress = () => (\n    <>\n      <ReactQuill theme=\"snow\" value={address} onChange={setAddress} />\n      <button className=\"btn btn-primary mt-2\" onClick={saveAddressToDb}>\n        Save\n      </button>\n    </>\n  );\n\n  const showProductSummary = () =>\n    products.map((p, i) => (\n      <div key={i}>\n        <p>\n          {p.product.title} ({p.color}) x {p.count} ={\" \"}\n          {p.product.price * p.count}\n        </p>\n      </div>\n    ));\n\n  const showApplyCoupon = () => (\n    <>\n      <input\n        onChange={(e) => {\n          setCoupon(e.target.value);\n          setDiscountError(\"\");\n        }}\n        value={coupon}\n        type=\"text\"\n        className=\"form-control\"\n      />\n      <button onClick={applyDiscountCoupon} className=\"btn btn-primary mt-2\">\n        Apply\n      </button>\n    </>\n  );\n\n  const createCashOrder = () => {\n    createCashOrderForUser(user.token, COD, couponTrueOrFalse).then((res) => {\n      console.log(\"USER CASH ORDER CREATED RES \", res);\n      // empty cart form redux, local Storage, reset coupon, reset COD, redirect\n      if (res.data.ok) {\n        // empty local storage\n        if (typeof window !== \"undefined\") localStorage.removeItem(\"cart\");\n        // empty redux cart\n        dispatch({\n          type: \"ADD_TO_CART\",\n          payload: [],\n        });\n        // empty redux coupon\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false,\n        });\n        // empty redux COD\n        dispatch({\n          type: \"COD\",\n          payload: false,\n        });\n        // mepty cart from backend\n        emptyUserCart(user.token);\n        // redirect\n        setTimeout(() => {\n          history.push(\"/user/history\");\n        }, 1000);\n      }\n    });\n  };\n\n  return (\n    <div className=\"row\">\n      <div className=\"col-md-6\">\n        <h4>Delivery Address</h4>\n        <h5 className='text-danger'>*Please Include Full Name and Address*</h5>\n        <h6 className='text-danger'>*Save Address Before Submitting Order*</h6>\n        <br />\n        <br />\n        {showAddress()}\n        <hr />\n        <h4>Got Coupon?</h4>\n        <br />\n        {showApplyCoupon()}\n        <br />\n        {discountError && <p className=\"bg-danger p-2\">{discountError}</p>}\n      </div>\n\n      <div className=\"col-md-6\">\n        <h4>Order Summary</h4>\n        <hr />\n        <p>Products {products.length}</p>\n        <hr />\n        {showProductSummary()}\n        <hr />\n        <p>Cart Total: {total}</p>\n\n        {totalAfterDiscount > 0 && (\n          <p className=\"bg-success p-2\">\n            Discount Applied: Total Payable: ${totalAfterDiscount}\n          </p>\n        )}\n\n        <div className=\"row\">\n          <div className=\"col-md-6\">\n            {COD ? (\n              <button\n                className=\"btn btn-primary\"\n                disabled={!addressSaved || !products.length}\n                onClick={createCashOrder}\n              >\n                Place Order\n              </button>\n            ) : (\n              <button\n                className=\"btn btn-primary\"\n                disabled={!addressSaved || !products.length}\n                onClick={() => history.push(\"/payment\")}\n              >\n                Place Order\n              </button>\n            )}\n          </div>\n\n          <div className=\"col-md-6\">\n            <button\n              disabled={!products.length}\n              onClick={emptyCart}\n              className=\"btn btn-primary\"\n            >\n              Empty Cart\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Checkout"]},"metadata":{},"sourceType":"module"}